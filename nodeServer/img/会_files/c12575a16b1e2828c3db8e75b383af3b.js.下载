/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2014 https://github.com/aralejs/qrcode/
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
define(function(){function f(r,i){for(var q in i){if(i.hasOwnProperty(q)){r[q]=i[q]}}return r}function n(i){if(i<128){return[i]}else{if(i<2048){c0=192+(i>>6);c1=128+(i&63);return[c0,c1]}else{c0=224+(i>>12);c1=128+(i>>6&63);c2=128+(i&63);return[c0,c1,c2]}}}function o(s){var p=[];for(var t=0;t<s.length;t++){var u=s.charCodeAt(t);var r=n(u);for(var q=0;q<r.length;q++){p.push(r[q])}}return p}function j(p,i){this.typeNumber=-1;this.errorCorrectLevel=i;this.modules=null;this.moduleCount=0;this.dataCache=null;this.rsBlocks=null;this.totalDataCount=-1;this.data=p;this.utf8bytes=o(p);this.make()}j.prototype={constructor:j,getModuleCount:function(){return this.moduleCount},make:function(){this.getRightType();this.dataCache=this.createData();this.createQrcode()},makeImpl:function(p){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount)}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(true,p);if(this.typeNumber>=7){this.setupTypeNumber(true)}this.mapData(this.dataCache,p)},setupPositionProbePattern:function(q,i){for(var p=-1;p<=7;p++){if(q+p<=-1||this.moduleCount<=q+p){continue}for(var s=-1;s<=7;s++){if(i+s<=-1||this.moduleCount<=i+s){continue}if((0<=p&&p<=6&&(s==0||s==6))||(0<=s&&s<=6&&(p==0||p==6))||(2<=p&&p<=4&&2<=s&&s<=4)){this.modules[q+p][i+s]=true}else{this.modules[q+p][i+s]=false}}}},createQrcode:function(){var t=0;var s=0;var p=null;for(var r=0;r<8;r++){this.makeImpl(r);var q=d.getLostPoint(this);if(r==0||t>q){t=q;s=r;p=this.modules}}this.modules=p;this.setupTypeInfo(false,s);if(this.typeNumber>=7){this.setupTypeNumber(false)}},setupTimingPattern:function(){for(var i=8;i<this.moduleCount-8;i++){if(this.modules[i][6]!=null){continue}this.modules[i][6]=(i%2==0);if(this.modules[6][i]!=null){continue}this.modules[6][i]=(i%2==0)}},setupPositionAdjustPattern:function(){var w=d.getPatternPosition(this.typeNumber);for(var s=0;s<w.length;s++){for(var q=0;q<w.length;q++){var u=w[s];var p=w[q];if(this.modules[u][p]!=null){continue}for(var t=-2;t<=2;t++){for(var v=-2;v<=2;v++){if(t==-2||t==2||v==-2||v==2||(t==0&&v==0)){this.modules[u+t][p+v]=true}else{this.modules[u+t][p+v]=false}}}}}},setupTypeNumber:function(s){var r=d.getBCHTypeNumber(this.typeNumber);for(var q=0;q<18;q++){var p=(!s&&((r>>q)&1)==1);this.modules[Math.floor(q/3)][q%3+this.moduleCount-8-3]=p;this.modules[q%3+this.moduleCount-8-3][Math.floor(q/3)]=p}},setupTypeInfo:function(u,t){var s=(g[this.errorCorrectLevel]<<3)|t;var r=d.getBCHTypeInfo(s);for(var q=0;q<15;q++){var p=(!u&&((r>>q)&1)==1);if(q<6){this.modules[q][8]=p}else{if(q<8){this.modules[q+1][8]=p}else{this.modules[this.moduleCount-15+q][8]=p}}var p=(!u&&((r>>q)&1)==1);if(q<8){this.modules[8][this.moduleCount-q-1]=p}else{if(q<9){this.modules[8][15-q-1+1]=p}else{this.modules[8][15-q-1]=p}}}this.modules[this.moduleCount-8][8]=(!u)},createData:function(){var q=new h();var r=this.typeNumber>9?16:8;q.put(4,4);q.put(this.utf8bytes.length,r);for(var s=0,p=this.utf8bytes.length;s<p;s++){q.put(this.utf8bytes[s],8)}if(q.length+4<=this.totalDataCount*8){q.put(0,4)}while(q.length%8!=0){q.putBit(false)}while(true){if(q.length>=this.totalDataCount*8){break}q.put(j.PAD0,8);if(q.length>=this.totalDataCount*8){break}q.put(j.PAD1,8)}return this.createBytes(q)},createBytes:function(C){var t=0;var J=0;var H=0;var q=this.rsBlock.length/3;var G=new Array();for(var E=0;E<q;E++){var w=this.rsBlock[E*3+0];var F=this.rsBlock[E*3+1];var L=this.rsBlock[E*3+2];for(var D=0;D<w;D++){G.push([L,F])}}var s=new Array(G.length);var x=new Array(G.length);for(var A=0;A<G.length;A++){var B=G[A][0];var p=G[A][1]-B;J=Math.max(J,B);H=Math.max(H,p);s[A]=new Array(B);for(var E=0;E<s[A].length;E++){s[A][E]=255&C.buffer[E+t]}t+=B;var y=d.getErrorCorrectPolynomial(p);var I=new b(s[A],y.getLength()-1);var u=I.mod(y);x[A]=new Array(y.getLength()-1);for(var E=0;E<x[A].length;E++){var z=E+u.getLength()-x[A].length;x[A][E]=(z>=0)?u.get(z):0}}var K=new Array(this.totalDataCount);var v=0;for(var E=0;E<J;E++){for(var A=0;A<G.length;A++){if(E<s[A].length){K[v++]=s[A][E]}}}for(var E=0;E<H;E++){for(var A=0;A<G.length;A++){if(E<x[A].length){K[v++]=x[A][E]}}}return K},mapData:function(t,p){var r=-1;var x=this.moduleCount-1;var s=7;var i=0;for(var q=this.moduleCount-1;q>0;q-=2){if(q==6){q--}while(true){for(var v=0;v<2;v++){if(this.modules[x][q-v]==null){var u=false;if(i<t.length){u=(((t[i]>>>s)&1)==1)}var w=d.getMask(p,x,q-v);if(w){u=!u}this.modules[x][q-v]=u;s--;if(s==-1){i++;s=7}}}x+=r;if(x<0||this.moduleCount<=x){x-=r;r=-r;break}}}}};j.PAD0=236;j.PAD1=17;var g=[1,0,3,2];var a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var d={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0),G18:(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0),G15_MASK:(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1),getBCHTypeInfo:function(i){var p=i<<10;while(d.getBCHDigit(p)-d.getBCHDigit(d.G15)>=0){p^=(d.G15<<(d.getBCHDigit(p)-d.getBCHDigit(d.G15)))}return((i<<10)|p)^d.G15_MASK},getBCHTypeNumber:function(i){var p=i<<12;while(d.getBCHDigit(p)-d.getBCHDigit(d.G18)>=0){p^=(d.G18<<(d.getBCHDigit(p)-d.getBCHDigit(d.G18)))}return(i<<12)|p},getBCHDigit:function(i){var p=0;while(i!=0){p++;i>>>=1}return p},getPatternPosition:function(i){return d.PATTERN_POSITION_TABLE[i-1]},getMask:function(r,q,p){switch(r){case a.PATTERN000:return(q+p)%2==0;case a.PATTERN001:return q%2==0;case a.PATTERN010:return p%3==0;case a.PATTERN011:return(q+p)%3==0;case a.PATTERN100:return(Math.floor(q/2)+Math.floor(p/3))%2==0;case a.PATTERN101:return(q*p)%2+(q*p)%3==0;case a.PATTERN110:return((q*p)%2+(q*p)%3)%2==0;case a.PATTERN111:return((q*p)%3+(q+p)%2)%2==0;default:throw new Error("bad maskPattern:"+r)}},getErrorCorrectPolynomial:function(q){var p=new b([1],0);for(var r=0;r<q;r++){p=p.multiply(new b([1,m.gexp(r)],0))}return p},getLostPoint:function(i){var q=i.getModuleCount(),r=0,x=0;for(var y=0;y<q;y++){var w=0;var v=i.modules[y][0];for(var p=0;p<q;p++){var t=i.modules[y][p];if(p<q-6){if(t&&!i.modules[y][p+1]&&i.modules[y][p+2]&&i.modules[y][p+3]&&i.modules[y][p+4]&&!i.modules[y][p+5]&&i.modules[y][p+6]){if(p<q-10){if(i.modules[y][p+7]&&i.modules[y][p+8]&&i.modules[y][p+9]&&i.modules[y][p+10]){r+=40}}else{if(p>3){if(i.modules[y][p-1]&&i.modules[y][p-2]&&i.modules[y][p-3]&&i.modules[y][p-4]){r+=40}}}}}if((y<q-1)&&(p<q-1)){var s=0;if(t){s++}if(i.modules[y+1][p]){s++}if(i.modules[y][p+1]){s++}if(i.modules[y+1][p+1]){s++}if(s==0||s==4){r+=3}}if(v^t){w++}else{v=t;if(w>=5){r+=(3+w-5)}w=1}if(t){x++}}}for(var p=0;p<q;p++){var w=0;var v=i.modules[0][p];for(var y=0;y<q;y++){var t=i.modules[y][p];if(y<q-6){if(t&&!i.modules[y+1][p]&&i.modules[y+2][p]&&i.modules[y+3][p]&&i.modules[y+4][p]&&!i.modules[y+5][p]&&i.modules[y+6][p]){if(y<q-10){if(i.modules[y+7][p]&&i.modules[y+8][p]&&i.modules[y+9][p]&&i.modules[y+10][p]){r+=40}}else{if(y>3){if(i.modules[y-1][p]&&i.modules[y-2][p]&&i.modules[y-3][p]&&i.modules[y-4][p]){r+=40}}}}}if(v^t){w++}else{v=t;if(w>=5){r+=(3+w-5)}w=1}}}var u=Math.abs(100*x/q/q-50)/5;r+=u*10;return r}};var m={glog:function(i){if(i<1){throw new Error("glog("+i+")")}return m.LOG_TABLE[i]},gexp:function(i){while(i<0){i+=255}while(i>=256){i-=255}return m.EXP_TABLE[i]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var c=0;c<8;c++){m.EXP_TABLE[c]=1<<c}for(var c=8;c<256;c++){m.EXP_TABLE[c]=m.EXP_TABLE[c-4]^m.EXP_TABLE[c-5]^m.EXP_TABLE[c-6]^m.EXP_TABLE[c-8]}for(var c=0;c<255;c++){m.LOG_TABLE[m.EXP_TABLE[c]]=c}function b(q,p){if(q.length==undefined){throw new Error(q.length+"/"+p)}var s=0;while(s<q.length&&q[s]==0){s++}this.num=new Array(q.length-s+p);for(var r=0;r<q.length-s;r++){this.num[r]=q[r+s]}}b.prototype={get:function(i){return this.num[i]},getLength:function(){return this.num.length},multiply:function(s){var q=new Array(this.getLength()+s.getLength()-1);for(var r=0;r<this.getLength();r++){for(var p=0;p<s.getLength();p++){q[r+p]^=m.gexp(m.glog(this.get(r))+m.glog(s.get(p)))}}return new b(q,0)},mod:function(u){var p=this.getLength(),t=u.getLength();if(p-t<0){return this}var q=new Array(p);for(var r=0;r<p;r++){q[r]=this.get(r)}while(q.length>=t){var s=m.glog(q[0])-m.glog(u.get(0));for(var r=0;r<u.getLength();r++){q[r]^=m.gexp(m.glog(u.get(r))+s)}while(q[0]==0){q.shift()}}return new b(q,0)}};var RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];j.prototype.getRightType=function(){for(var v=1;v<41;v++){var q=RS_BLOCK_TABLE[(v-1)*4+this.errorCorrectLevel];if(q==undefined){throw new Error("bad rs block @ typeNumber:"+v+"/errorCorrectLevel:"+this.errorCorrectLevel)}var t=q.length/3;var r=0;for(var p=0;p<t;p++){var s=q[p*3+0];var u=q[p*3+2];r+=u*s}var w=v>9?2:1;if(this.utf8bytes.length+w<r||v==40){this.typeNumber=v;this.rsBlock=q;this.totalDataCount=r;break}}};function h(){this.buffer=new Array();this.length=0}h.prototype={get:function(i){var p=Math.floor(i/8);return((this.buffer[p]>>>(7-i%8))&1)},put:function(p,r){for(var q=0;q<r;q++){this.putBit(((p>>>(r-q-1))&1))}},putBit:function(p){var i=Math.floor(this.length/8);if(this.buffer.length<=i){this.buffer.push(0)}if(p){this.buffer[i]|=(128>>>(this.length%8))}this.length++}};var e=[];var k=function(r){if(typeof r==="string"){r={text:r}}this.options=f({text:"",render:"",width:256,height:256,correctLevel:3,background:"#ffffff",foreground:"#000000"},r);var s=null;for(var q=0,p=e.length;q<p;q++){if(e[q].text==this.options.text&&e[q].text.correctLevel==this.options.correctLevel){s=e[q].obj;break}}if(q==p){s=new j(this.options.text,this.options.correctLevel);e.push({text:this.options.text,correctLevel:this.options.correctLevel,obj:s})}if(this.options.render){switch(this.options.render){case"canvas":return this.createCanvas(s);case"table":return this.createTable(s);case"svg":return this.createSVG(s);default:return this.createDefault(s)}}return this.createDefault(s)};k.prototype.createDefault=function(p){var i=document.createElement("canvas");if(i.getContext){return this.createCanvas(p)}SVG_NS="http://www.w3.org/2000/svg";if(!!document.createElementNS&&!!document.createElementNS(SVG_NS,"svg").createSVGRect){return this.createSVG(p)}return this.createTable(p)};k.prototype.createCanvas=function(t){var p=document.createElement("canvas");p.width=this.options.width;p.height=this.options.height;var v=p.getContext("2d");var i=(this.options.width/t.getModuleCount()).toPrecision(4);var s=this.options.height/t.getModuleCount().toPrecision(4);for(var x=0;x<t.getModuleCount();x++){for(var q=0;q<t.getModuleCount();q++){v.fillStyle=t.modules[x][q]?this.options.foreground:this.options.background;var u=(Math.ceil((q+1)*i)-Math.floor(q*i));var r=(Math.ceil((x+1)*i)-Math.floor(x*i));v.fillRect(Math.round(q*i),Math.round(x*s),u,r)}}return p};k.prototype.createTable=function(v){var x=[];x.push('<table style="border:0px; margin:0px; padding:0px; border-collapse:collapse; background-color: '+this.options.background+';">');var i=-1,t=-1,r=-1,p=-1;i=r=Math.floor(this.options.width/v.getModuleCount());t=p=Math.floor(this.options.height/v.getModuleCount());if(r<=0){if(v.getModuleCount()<80){i=2}else{i=1}}if(p<=0){if(v.getModuleCount()<80){t=2}else{t=1}}foreTd='<td style="border:0px; margin:0px; padding:0px; width:'+i+"px; background-color: "+this.options.foreground+'"></td>',backTd='<td style="border:0px; margin:0px; padding:0px; width:'+i+"px; background-color: "+this.options.background+'"></td>',l=v.getModuleCount();for(var w=0;w<l;w++){x.push('<tr style="border:0px; margin:0px; padding:0px; height: '+t+'px">');for(var q=0;q<l;q++){x.push(v.modules[w][q]?foreTd:backTd)}x.push("</tr>")}x.push("</table>");var u=document.createElement("span");u.innerHTML=x.join("");return u.firstChild};k.prototype.createSVG=function(A){var z,D,w,B,r=A.getModuleCount(),t=this.options.height/this.options.width,u='<svg xmlns="http://www.w3.org/2000/svg" width="'+this.options.width+'px" height="'+this.options.height+'px" viewbox="0 0 '+r*10+" "+r*10*t+'">',v="<path ",q=' style="stroke-width:0.5;stroke:'+this.options.foreground+";fill:"+this.options.foreground+';"></path>',i=' style="stroke-width:0.5;stroke:'+this.options.background+";fill:"+this.options.background+';"></path>';for(var C=0;C<r;C++){for(var p=0;p<r;p++){z=p*10;w=C*10*t;D=(p+1)*10;B=(C+1)*10*t;u+=v+'d="M '+z+","+w+" L "+D+","+w+" L "+D+","+B+" L "+z+","+B+' Z"';u+=A.modules[C][p]?q:i}}u+="</svg>";var s=document.createElement("DIV");s.innerHTML=u;return s.firstChild};return k});